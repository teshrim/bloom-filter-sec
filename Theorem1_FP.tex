\heading{Linear-PRF construction. }
Here we consider a hash-based filter that was attacked by Neidermayer et al. in~\cite{xxx}.  Let $B_{\mathrm{lin}}=(\Hash,\Rep,\Qry)$ be defined as follows.  Fix non-empty set ~$\univ$ and integers $k,m,n>0$.  Let $F\colon\mathcal{K} \times \univ \to [m]$ be a function family.  The $\Hash$ algorithm samples two keys $K_0,K_1 \getsr \mathcal{K}$ and defines $h_j(x) = F_{K_0}(x) + j\cdot F_{K_1}(x) \bmod m$ for $j \in [k]$.  The $\Rep$ and $\Qry$ algorithms are the standard (determinisitic) BF ones. The following result shows, informally, that if~$F$ is a good PRF and the (non-adaptive) FP rate is sufficiently small, then $B_\mathrm{lin}$ is secure against adaptive FP-finding adversaries.

\fixme{Note: the following theorem is incorrect for $t>1$.  Or, at least, the proof does not cover $t>1$.}\acnote{Modified.}
\begin{theorem}\label{thm1}
Fix $k,m,n>0$, and let $B_\mathrm{lin}=(\Hash,\Rep,\Qry)$ be the hash-based filter just described. 
Let~$A$ be an adversary, compatible with $\ExpFPSecHash{B_\mathrm{lin},t}{\cdot}$, that asks at most~$q$ queries to its $\QryOracle$ oracle.  Then there exist adversaries~$B_1$ and $B_2$ such that
\[
\AdvFPSecHash{B_{\mathrm{lin}},t}{A} \leq  \AdvPRF{F}{B_1} +
\AdvPRF{F}{B_2}  +{\dbinom{q}{t}} \left( (1-e^{-kn/m})^k + O(1/n) \right)^t
\]
\end{theorem}
Before giving the proof, we note that Kirsch and Mitzenmacher~\cite{xxx} show
that the ($t=1$, non-adaptive) FP-probability for~$B_\mathrm{lin}$ is
always within $O(1/n)$ of $(1-e^{-kn/m})^k$, although the asymptotic
rate of convergence is faster than~$1/n$.  The factor of $\dbinom{q}{t}$ arises as a result
of removing adaptivity.  Finally, $\dbinom{q}{t} \leq q^t$ (with
reasonable tightness when~$t$ is small) in which case the final term in the bound behaves as 
$(q (1-e^{-kn/m})^k + O(q/n) )^t$; loosely, the bound one expects for
trying to find a single FP in each of~$t$ independent``rounds'', each round
consisting of~$q$ attempts.
%Before giving the proof, we note that  $(1-e^{-kn/m})^k \rightarrow 0$ as the ratio between the bit-length of the representation~$M$ and the size of the represented set~$S$, i.e.,$m/n$ tends to $\infty$.
%
\begin{proof}[\Cref{thm1}]
The proof of the theorem will use a game playing argument as shown in \Cref{fig:Game}. $\game{0}(A)$ exactly simulates $\ExpFPSecHash{B_\mathrm{lin},t}{A}$ with hash functions $h_j(x) =  F_{K_0}(x) + j\cdot F_{K_1}(x) \bmod m$. So,
\begin{equation}
\AdvFPSecHash{B_{\mathrm{lin}},t}{A} = \Prob{\game{0}(A)=1}\label{eq:0}
\end{equation}
 $\game{1}(A)$ and $\game{2}(A)$ attack 2 different filters with hash functions 
$h_j(x) = ( F_{K_0}(x) + j\cdot \rho_2(x)) \bmod m$ and $h_j(x) = ( \rho_1(x) + j \cdot \rho_2(x)) \bmod m$, respectively.
Here, $\rho_1$ and $\rho_2$ are random functions sampled from $\Func{\univ,[m]}$. \\
\noindent
Let adversaries $B_1, B_2$ simulate $\game{1}(A)$ and $\game{2}(A)$ respectively as shown in \Cref{fig:BGame1}. When $b=0$, $B_1$ wins if $\game{1}(A)$ outputs 0; $B_2$ wins if $\game{2}(A)$ returns 0. When $b=1$, $B_1$ and $B_2$ exactly simulate $\game{0}(A)$ and $\game{1}(A)$. Thus, we have

\begin{align}
\Prob{\ExpPRF{F}{B_1} = 1\,|\,b=1} &= \Prob{\game{0}(A)=1}\label{eq:m1}\\
\Prob{\ExpPRF{F}{B_2} = 1\,|\,b=1} &= \Prob{\game{1}(A)=1}\label{eq:m2}\\
\Prob{\ExpPRF{F}{B_1} = 1\,|\,b=0} &= 1-\Prob{\game{1}(A)=1}\label{eq:m3}\\
\Prob{\ExpPRF{F}{B_2} = 1\,|\,b=0} &= 1-\Prob{\game{2}(A)=1}\label{eq:m4}
\end{align}

%\caption{Game playing argument}\label{fig:Game}
\begin{figure}
\fpage{.9}{
\hpagessl{.45}{.5}
{
\underline{\game{0}(A)}\\
$K_1, K_2 \getsr \calK$\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
$\calZ \getsr A^{\QryOracle}(\calS)$\\
if $|\calZ| < t$ or $\calZ \cap \calS \neq \emptyset$ then \\
\nudge Ret 0\\
if $\exists z \in \calZ$ s.t. $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
%
\oracle{$\QryOracle(x)$}\\
Ret $\Qry^{\HashOracle}(M,x)$\\\\
%
\oracle{$\HashOracle(x)$}\\
$h_i(x) = F_{K_1}(x)+i \cdot F_{K_2}(x)$, for $i\in[1,k]$\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
{
\underline{\game{1}(A)}\\
$K_1 \getsr \calK$\\
$\rho \getsr \Func{\univ,[m]}$\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
$\calZ \getsr A^{\QryOracle}(\calS)$\\
if $|\calZ| < t$ or $\calZ \cap \calS \neq \emptyset$ then \\
\nudge Ret 0\\
if $\exists z \in \calZ$ s.t. $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
%
\oracle{$\QryOracle(x)$}\\
Ret $\Qry^{\HashOracle}(M,x)$\\\\
%
\oracle{$\HashOracle(x)$}\\
$h_i(x) = F_{K_1}(x)+i \cdot \rho(x)$, for $i\in[1,k]$\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
}
\fpage{.9}{
\hpagessl{.45}{.5}
{
\underline{\game{2}(A)}\\
$\rho_1,\rho_2 \getsr \Func{\univ,[m]}$\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
$\calZ \getsr A^{\QryOracle}(\calS)$\\
if $|\calZ| < t$ or $\calZ \cap \calS \neq \emptyset$ then \\
\nudge Ret 0\\
if $\exists z \in \calZ$ s.t. $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
%
\oracle{$\QryOracle(x)$}\\
Ret $\Qry^{\HashOracle}(M,x)$\\\\
%
\oracle{$\HashOracle(x)$}\\
$h_i(x) = \rho_1(x)+i \cdot \rho_2(x)$, for $i\in[1,k]$\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
{
\underline{$\game{3}(A)$}\\
$\calY \gets \emptyset $\\
$\rho_1,\rho_2 \getsr \Func{\univ,[m]}$\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
$\calZ \getsr A^{\QryOracle}(\calS)$\\
$z_1,\cdots, z_t \getsr \calY $\\
if $\exists i\in[1,t] \,\mbox{s.t.} \,\Qry^{\HashOracle}(M,z_i)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
%
\oracle{$\QryOracle(x)$}\\
$\calY \gets \calY \cup x$\\
Ret $\Qry^{\HashOracle}(M,x)$\\
%
\oracle{$\HashOracle(x)$}\\
$h_i(x) = \rho_1(x)+i \cdot \rho_2(x)$, for $i\in[1,k]$\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
}
\caption{\Cref{thm1}:Game playing argument}\label{fig:Game}
\end{figure}

%\caption{Adversary $B_1, B_2$ simulating $\game{1}(A)$ and $\game{2}(A)$ respectively}\label{fig:BGame1}
\begin{figure}
\centering
\fpage{0.9}{
\hpagessl{0.5}{0.5}
{
$\adversaryv{B_1^{\calO}}$\\
$K_1 \getsr \calK $\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
When $A$ asks $\QryOracle(x)$:\\
$\nudge$ Ret $\Qry^{\HashOracle}(M,x)$\\
When $A$ halts with output $\calZ'$: \\
if $|\calZ'| < t$ or $\calZ' \cap \calS \neq \emptyset$ then \\
\nudge Ret 0\\
if $\exists z \in \calZ'$ s.t. $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
\oracle{$\HashOracle(x)$}\\
$ \mathrm{Ret} \nudge F_{K_1}(x) + i\cdot \calO(x)$, for $i\in[1,k]$\\
}
{
$\adversaryv{B_2^{\calO}}$\\
%$d \getsr \bits $\\
$\rho_2 \getsr \Func(\univ,[m])$ \\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
When $A$ asks $\QryOracle(x)$:\\
$\nudge$ Ret $\Qry^{\HashOracle}(M,x)$\\
When $A$ halts with output $\calZ'$: \\

if $|\calZ'| < t$ or $\calZ' \cap \calS \neq \emptyset$ then \\
\nudge Ret 0\\
if $\exists z \in \calZ'$ s.t. $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
\oracle{$\HashOracle(x)$}\\
%if $d=0$\\
$\mathrm{Ret} \nudge \calO(x) + i\cdot \rho_2(x)$, for $i\in[1,k]$
}
}
\caption{\Cref{thm1}:Adversary $B_1, B_2$ simulating $\game{1}(A)$ and $\game{2}(A)$ respectively}\label{fig:BGame1}
\end{figure}
\noindent
From \Cref{eq:m1,eq:m2,eq:m3,eq:m4}, \acnote{compacted} \tsnote{this can be compacted}
\begin{align}
\nonumber \Prob{\ExpPRF{F}{B_1} = 1} &= .5\Prob{\ExpPRF{F}{B_1}=1\,|\,b=0} + .5\Prob{\ExpPRF{F}{B_1} = 1\,|\,b=1}\\
\nonumber 2\Prob{\ExpPRF{F}{B_1} = 1} &= 1-\Prob{\game{1}(A)=1} + \Prob{\game{0}(A)=1}\\
\nonumber (2\Prob{\ExpPRF{F}{B_1} = 1} - 1)  &= \Prob{\game{0}(A)=1} - \Prob{\game{1}(A)=1}\\
 \AdvPRF{F}{B_1} &= \Prob{\game{0}(A)=1} - \Prob{\game{1}(A)=1} \label{eq:1}\\
\nonumber& &\\
\nonumber \Prob{\ExpPRF{F}{B_2} = 1} &= .5\Prob{\ExpPRF{F}{B_2}=1\,|\,b=0} + .5\Prob{\ExpPRF{F}{B_2} = 1\,|\,b=1}\\
\nonumber 2\Prob{\ExpPRF{F}{B_2} = 1} &= 1-\Prob{\game{2}(A)=1} + \Prob{\game{1}(A)=1}\\
\nonumber (2\Prob{\ExpPRF{F}{B_2} = 1} - 1)  &= \Prob{\game{1}(A)=1} - \Prob{\game{2}(A)=1}\\
 \AdvPRF{F}{B_2} &= \Prob{\game{1}(A)=1} - \Prob{\game{2}(A)=1} \label{eq:2a}
\end{align}

\noindent
Adding \Cref{eq:1,eq:2a}, we have
\begin{equation}
\AdvPRF{F}{B_2} +\AdvPRF{F}{B_1} = \Prob{\game{0}(A)=1} - \Prob{\game{2}(A)=1}\label{eq:2}
\end{equation}

\noindent
In $\game{3}(A)$, $t$ elements are sampled from the $q$ queries with probability  $1/\dbinom{q}{t}$ and tested for false positives. So, 
\begin{equation}
\Prob{\game{2}(A)=1} = \frac{1}{\dbinom{q}{t}}\times\Prob{\game{3}(A)=1}\label{eq:3}
\end{equation}

\noindent
The classical FP requirement considers only non-adaptive (and information-theoretic) adversaries and $A'$ is one such adversary simulating $\game{3}(A)$. \acnote{changed}\tsnote{The classical FP requirement considers only non-adaptive (and information-theoretic) adversaries.  It suffices to say this.} From \Cref{fig:AGame3} and $\game{3}(A)$, it is evident that
\begin{align}
\nonumber \Prob{\game{3}(A)=1} &= q\Prob{A' \mbox{outputs FP}}\\
& \leq q\times(1-e^{-kn/m})^k \label{eq:4}
\end{align}

%\caption{Adversary $A'$ simulating $\game{3}(A)$} \label{AGame3}
\begin{figure}
\centering
\fpage{0.4}{
$\adversaryv{A'^{\HashOracle}}$\\
$\calY \gets \emptyset $ \\
$\ell \getsr [q]$\\
$c = 0$\\
$\rho \getsr Func(U,[m])$\\
$S \getsr \distr{U}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
When $A$ asks $\QryOracle(x)$:\\
$\nudge c = c + 1$\\
\nudge if $c == \ell$\\
$\nudge$ $\nudge r \gets \Qry^{\HashOracle}(M,x)$\\
$\nudge$ $\nudge \calY \gets \calY \cup x$\\
\nudge else\\
$\nudge$ $\nudge r = 0$\\
\nudge Ret $r$\\
When $A$ halts with output $\calZ'$\\
\nudge $z \gets \calY$\\
\nudge if $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge \nudge Ret 0\\
\nudge Ret 1\\\\
%
\oracle{$\HashOracle(x)$}\\
$h_i(x) = \rho_1(x)+i \cdot \rho_2(x)$, for $i\in[1,k]$\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
\caption{\Cref{thm1}:Adversary $A'$ simulating $\game{3}(A)$} \label{fig:AGame3}
\end{figure}	

\noindent
From \Cref{eq:0,eq:2,eq:3,eq:4} \\
\begin{align}
\nonumber \AdvFPSecHash{B_{\mathrm{lin}},t}{A} &- \Prob{\game{2}(A)=1} =  \AdvPRF{F}{B_1} + \AdvPRF{F}{B_2}   \\
\nonumber \AdvFPSecHash{B_{\mathrm{lin}},t}{A}  &=  \AdvPRF{F}{B_1} + \AdvPRF{F}{B_2} + \Prob{\game{2}(A)=1}  \\
\AdvFPSecHash{B_{\mathrm{lin}},t}{A} &\leq  \AdvPRF{F}{B_1} + \AdvPRF{F}{B_2}  + \frac{q}{\dbinom{q}{t}} \times  (1-e^{-kn/m})^k
\end{align}
\end{proof}

