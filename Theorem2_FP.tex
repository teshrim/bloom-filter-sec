\newcommand{\FK}{F_K(\langle j,x \rangle)}
\newcommand{\rhoK}{\rho(\langle j,x \rangle)}
\fixme{Clean up to match style, language and typesetting (macros,
  especially) of previous theorem.}\acnote{Modified.}

Let $B_{\mathrm{lin}}=(\Hash,\Rep,\Qry)$ be the hash-based filter defined as earlier, except the private hash functions of the $\HashOracle'$s algorithm are $h_j(x) = \FK, \, j \in [1,k]$. Informally, if F is PRF secure and the filter has low FP-error in the non-adaptive setting, then $B_{\mathrm{lin}}$ is secure against adaptive FP-finding adversaries.
\begin{theorem}\label{thm2}
Fix $k,m,n >0$. Let $B_{\mathrm{lin}}$ be the hash based filter just described. If there exists an adaptive adversary $A$ compatible with $\ExpFPPubHash{B_{\mathrm{lin},t}}{\cdot}$, then there exists an adversary $B$ attacking the PRF game such that
\begin{equation}
\AdvFPSecHash{B_\mathrm{lin},t}{A}\leq  \AdvPRF{F}{B}  + \frac{q}{\dbinom{q}{t}} \times  (1-e^{-kn/m})^k
\end{equation}
Before giving the proof, it should be noted that $\FK$ provides domain separation and hence mutual independence, unlike hash functions in \Cref{thm1}
\end{theorem}

\begin{proof}[\Cref{thm2}]
We use a game playing argument similar to \Cref{thm1} to prove this theorem. In \game{0}(A), adversary attacks the FP game with private hash functions $h_j(x) = \FK $, and hence exactly simulates $\ExpFPSecHash{B_\mathrm{lin},t}{A}$.
\begin{equation}
\AdvFPSecHash{B_\mathrm{lin},t}{A} = \Prob{\game{0}(A)=1}\label{eq:0T2}
\end{equation}
\noindent
\game{1}(A) simulates $\ExpFPSecHash{B_\mathrm{lin},t}{A}$ with a random function $\rho \getsr Func(\univ,[m])$ used to generate uniformly random  hash-indices with domain separation, of elements $x \in \univ$. In $\game{2}(A)$, $t$ elements are sampled from the set of queries and tested for false positives.  The three games are shown in \Cref{fig:GameT2}.

%\caption{Game playing argument}\label{fig:Game}
\begin{figure}
\fpage{.99}{
\hpagesssl{.34}{.34}{.31}
{
\underline{\game{0}(A)}\\
$K_1, K_2 \getsr \calK$\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
$\calZ \getsr A^{\QryOracle}(\calS)$\\
if $|\calZ| < t$ or $\calZ \cap \calS \neq \emptyset$ then \\
\nudge Ret 0\\
if $\exists z \in \calZ$ s.t. $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
%
\oracle{$\QryOracle(x)$}\\
Ret $\Qry^{\HashOracle}(M,x)$\\\\
%
\oracle{$\HashOracle(x)$}\\
$h_j(x) = \FK$\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
{
\underline{\game{1}(A)}\\
$\rho \getsr \Func{\univ,[m]}$\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
$\calZ \getsr A^{\QryOracle}(\calS)$\\
if $|\calZ| < t$ or $\calZ \cap \calS \neq \emptyset$ then \\
\nudge Ret 0\\
if $\exists z \in \calZ$ s.t. $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
%
\oracle{$\QryOracle(x)$}\\
Ret $\Qry^{\HashOracle}(M,x)$\\\\
%
\oracle{$\HashOracle(x)$}\\
$h_j(x) = \rhoK $\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
{
\underline{\game{2}(A)}\\
$\calY \gets \emptyset $\\
$\rho \getsr \Func{\univ,[m]}$\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
$\calZ \getsr A^{\QryOracle}(\calS)$\\
$z_1,\cdots, z_t \getsr \calY $\\
if $\exists i\in[1,t] \, \mbox{s.t.} \,\Qry^{\HashOracle}(M,z_i)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
%
\oracle{$\QryOracle(x)$}\\
$\calY \gets \calY \cup x$\\
Ret $\Qry^{\HashOracle}(M,x)$\\
%
\oracle{$\HashOracle(x)$}\\
$h_j(x) = \rhoK$\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
}
\caption{\Cref{thm2}:Game playing argument}\label{fig:GameT2}
\end{figure}

\noindent
In \Cref{fig:BGame1T2}, adversary $B$ simulates $\game{0}(A)$ and $\game{1}(A)$ for $b=1$ and $b=0$ respectively .

%\caption{Adversary $B$ and $A'$ simulating $\game{1}(A)$ and $\game{2}(A)$ respectively}
\begin{figure}
\centering
\fpage{0.9}{
\hpagessl{0.5}{0.5}
{
$\adversaryv{B^{\calO}}$\\
$K_1 \getsr \calK $\\
$S \getsr \distr{\univ}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
When $A$ asks $\QryOracle(x)$:\\
$\nudge$ Ret $\Qry^{\HashOracle}(M,x)$\\
When $A$ halts with output $\calZ'$: \\
if $|\calZ'| < t$ or $\calZ' \cap \calS \neq \emptyset$ then \\
\nudge Ret 0\\
if $\exists z \in \calZ'$ s.t. $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge Ret 0\\
Ret 1\\\\
\oracle{$\HashOracle(x)$}\\
$ \mathrm{Ret} \nudge \calO(\langle j,x \rangle)$, for $j\in[1,k]$\\
}
{
$\adversaryv{A'^{\HashOracle}}$\\
$\calY \gets \emptyset $ \\
$\ell \getsr [q]$\\
$c = 0$\\
$\rho \getsr Func(U,[m])$\\
$S \getsr \distr{U}{n}$\\
$M \getsr \Rep^{\HashOracle}(\calS)$\\
When $A$ asks $\QryOracle(x)$:\\
$\nudge c = c + 1$\\
\nudge if $c == \ell$\\
$\nudge$ $\nudge r \gets \Qry^{\HashOracle}(M,x)$\\
$\nudge$ $\nudge \calY \gets \calY \cup x$\\
\nudge else\\
$\nudge$ $\nudge r = 0$\\
\nudge Ret $r$\\
When $A$ halts with output $\calZ'$\\
\nudge $z \gets \calY$\\
\nudge if $\Qry^{\HashOracle}(M,z)=0$ then\\
\nudge \nudge Ret 0\\
\nudge Ret 1\\\\
%
\oracle{$\HashOracle(x)$}\\
$\mathrm{Ret} \nudge \rhoK$
}
}
\caption{\Cref{thm2}:Adversary $B$ and $A'$ simulating $\game{0}(A)$, $\game{1}(A)$ and $\game{2}(A)$ respectively }\label{fig:BGame1T2}
\end{figure}

\begin{align}
\Prob{\ExpPRF{F}{B} = 1|b=1} &= \Prob{\game{0}(A)=1}\label{eq:m1T2}\\
\Prob{\ExpPRF{F}{B} = 1|b=0} &= 1-\Prob{\game{1}(A)=1}\label{eq:m2T2}
\end{align}

\noindent
From \Cref{eq:m1T2,eq:m2T2},
\begin{align}
\nonumber \Prob{\ExpPRF{F}{B} = 1} &= .5\Prob{\ExpPRF{F}{B_1}=1|b=0} + .5\Prob{\ExpPRF{F}{B_1} = 1|b=1}\\
\nonumber 2\Prob{\ExpPRF{F}{B} = 1} &= 1-\Prob{\game{1}(A)=1} + \Prob{\game{0}(A)=1}\\
\nonumber (2\Prob{\ExpPRF{F}{B} = 1} - 1)  &= \Prob{\game{0}(A)=1} - \Prob{\game{1}(A)=1}\\
 \AdvPRF{F}{B} &= \Prob{\game{0}(A)=1} - \Prob{\game{1}(A)=1} \label{eq:1T2}
\end{align}

\noindent
Following a similar argument from \Cref{thm1}\fixme{For $t>1$, proof fails for $t>1$}\acnote{Modified.}
\begin{equation}
\Prob{\game{1}(A)=1} = \frac{1}{\dbinom{q}{t}}\times\Prob{\game{2}(A)=1}\label{eq:3T2}
\end{equation}

\begin{align}
\nonumber \Prob{\game{2}(A)=1} &= q\Prob{A' \mbox{outputs FP}}\\
& \leq q \times (1-e^{-kn/m})^k \label{eq:4T2}
\end{align}


\noindent
From \Cref{eq:0T2,eq:1T2,eq:3T2,eq:4T2}: \\
\begin{align}
\nonumber \AdvFPSecHash{B_\mathrm{lin},t}{A} &- \Prob{\game{1}(A)=1} =  \AdvPRF{F}{B}   \\
\nonumber \AdvFPSecHash{B_\mathrm{lin},t}{A}  &=  \AdvPRF{F}{B} + \Prob{\game{1}(A)=1}  \\
\AdvFPSecHash{B_\mathrm{lin},t}{A} &\leq  \AdvPRF{F}{B}  + \frac{q}{\dbinom{q}{t}} \times  (1-e^{-kn/m})^k
\end{align}


\end{proof}
