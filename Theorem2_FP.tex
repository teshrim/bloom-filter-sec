\newcommand{\FK}{F_K(\langle j,x \rangle)}
\newcommand{\rhoK}{\rho(\langle j,x \rangle)}
\newcommand{\OK}{\calO(\langle j,x \rangle)}

\begin{proof}[\Cref{thm2}]
We use a game playing argument (shown in \Cref{fig:2TGame}) similar to \Cref{thm1} to prove this theorem. In \game{0}, adversary attacks the correctness game with  hash functions $h_j(x) = \FK $, and hence exactly simulates $\ExpCorrect{\Pi_{\mathrm{ds}},\distr{\calS}{},r}{A}$.
\begin{equation}
\AdvCorrect{\Pi_{\mathrm{ds}},\distr{\calS}{},r}{A} = \Prob{\game{0}(A)=1}\label{eq:2T0}
\end{equation}

Let $B$ be a prf-adversary as shown in \Cref{fig:2TD}. Based on its challenge bit $b$, it exactly simulates $\game{0}$ or $\game{1}$. So,
\begin{align*}
\Prob{\ExpPRF{F}{B} = 1\,|\,b=1} &= \Prob{\game{0}(A)=1} \\%\label{eq:m1}\\
\Prob{\ExpPRF{F}{B} = 1\,|\,b=0} &= 1-\Prob{\game{1}(A)=1}
\end{align*}

By a standard conditioning of PRF advantage, we have

\begin{equation*}
\Prob{\game{0}(A)=1} = \AdvPRF{F}{B} + \Prob{\game{1}(A)=1}%\label{eq:13}
\end{equation*}

In $\game{1}$, $A$ attacks a different filter $\tilde{\Pi}_\mathrm{ds}$, in which $F_K$ is replaced by a random function. $\game{2}$ and $\game{3}$ on the other hand use lazy sampling in $\Hash$ to select random values from $[m]$. It can be observed that, except  $\Hash$, $\game{2}$ and $\game{3}$ are identical to $\game{3}$ and $\game{4}$ of previous theorem. Since, $\Hash$ in all of these games returns random values, the analyses and intermediate results of \Cref{thm1} apply to this theorem as well. Therefore,
\begin{align*}
\Prob{\game{1}(A)=1} = \Prob{\game{2}(A)=1}\\
\Prob{\game{3}(A)=1} = \frac{1}{\dbinom{q}{r}}\Prob{\game{2}(A)=1}
\end{align*}

Let $D$ be a zero-query adversary (shown in \Cref{fig:D}) that finds ~$r$ false positives against $\tilde{\Pi}_{\mathrm{ds}}$. Using explanations from previous theorem, if $A$ wins $\game{3}$, then $D$ wins $\ExpCorrect{\tilde{\Pi}_{\mathrm{ds}},\distr{\calS}{},r}{\cdot}$ game. So, 
\begin{equation*}
\AdvCorrect{\tilde{\Pi}_{\mathrm{ds}},\distr{\calS}{},r}{D} = \Prob{\game{3}(A) = 1}\label{eq:2T8}
\end{equation*}

Note that like $\tilde{\Pi}_{\mathrm{lin}}$, $\tilde{\Pi}_{\mathrm{ds}}$ is the scheme that is analyzed in the classical Bloom filter literature. So, for a zero-query adversary $D$ and $r=1$, the upper bound on false-positive probability of a classical Bloom filter applies to $\tilde{\Pi}_{\mathrm{ds}}$ as well. For $r > 1$, based on the assumption that $A$ makes no pointless queries, the queries made by $A$ are distinct and not elements of the original set $S$. Also, since $\game{3}$ uses independent random functions, the event of getting a false positive is independent of the index of the query. So,
\begin{equation*}
\AdvCorrect{\tilde{\Pi}_{\mathrm{ds}},\distr{\calS}{},r}{D} =   {\dbinom{q}{r}} \left( (1-e^{-kn/m})^k + O(1/n) \right)^r
\end{equation*}
\noindent
To summarize, we have
\[
\AdvCorrect{\Pi_{\mathrm{ds}},\distr{\calS}{},r}{A} \leq  \AdvPRF{F}{B}  + {\dbinom{q}{r}} \left( (1-e^{-kn/m})^k + O(1/n) \right)^r
\]
which is the bound claimed in the theorem statement. %\hfill \qed

%\caption{Game playing argument}\label{fig:Game}
\begin{figure}
\fpage{.9}{
\hpagessl{.45}{.5}
{
\underline{\game{0}(A)}\\
$S \getsr \distr{\calS}{}$\\
$\err \gets 0$\\
$(\pubaux,\privaux) \getsr \Rep^{\HashOracle}(S)$\\
$z \getsr A^{\TestOracle}(S,\pubaux)$\\
if $\err  < r$ then Return 0\\
Return 1\\\\
%
\oracle{$\TestOracle(q_x)$}\\
$a \gets \Qry^{\HashOracle}(\pubaux,\privaux,q_x)$\\
if $a \neq q_x(S)$ then \\
\nudge $\err \gets\err +1$\\
Return~$(a,\err )$\\\\
%
\oracle{$\HashOracle(x)$}\\
for $j = 1$ to $k$\\
\nudge $h_j(x) =\FK $\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
{
\underline{\game{1}(A)}\\
$\rho \getsr \Func{\univ,[m]}$\\
$S \getsr \distr{\calS}{}$\\
$\err \gets 0$\\
$(\pubaux,\privaux) \getsr \Rep^{\HashOracle}(S)$\\
$z \getsr A^{\TestOracle}(S,\pubaux)$\\
if $\err  < r$ then Return 0\\
Return 1\\\\
%
\oracle{$\TestOracle(q_x)$}\\
$a \gets \Qry^{\HashOracle}(\pubaux,\privaux,q_x)$\\
if $a \neq q_x(S)$ then \\
\nudge $\err \gets\err +1$\\
Return~$(a,\err )$\\\\
%
\oracle{$\HashOracle(x)$}\\
for $j=1$ to $k$\\
\nudge $h_j(x) = \rhoK $\\
Ret $\left(h_1(x),\ldots,h_k(x)\right)$
}
}
\fpage{.9}{
\hpagessl{.45}{.5}
{
\underline{{$\game{2}(A)$},\fbox{$\game{3}(A)$}}\\
$c\gets 0$, $\bad \gets \false$\\
$\mathcal{I}\getsr [\{1,2,\ldots,q\}]^r$\\
$S \getsr \distr{\calS}{}$\\
$\err \gets 0$\\
$(\pubaux,\privaux) \getsr \Rep^{\HashOracle}(S)$\\
$z \getsr A^{\TestOracle}(S,\pubaux)$\\
if $\bad = \true$ then \fbox{Return 0}\\
if $\err  < r$ then Return 0\\
Return 1
}
%
{
\oracle{$\TestOracle(q_x)$}\\
$c \gets c+1$\\
$v \gets \Qry^{\HashOracle}(\pubaux,\privaux,q_x)$\\
if $c \in \mathcal{I}$ and $v = q_x(S)$ then \\
\nudge $\bad \gets \true$ \\
if $c \not\in \mathcal{I}$ and $v \neq q_x(S)$ then \\
\nudge $\bad \gets \true$\\
if $v \neq q_x(S)$\\
\nudge $\err \gets\err +1$\\
Return~$(v,\err )$\\\\
%
\oracle{$\HashOracle(x)$}\\
for $j = 1$ to~$k$\\
\nudge $v_j \getsr [m]$\\
Ret $\left(v_1,\ldots,v_k\right)$
}
}
\caption{\Cref{thm2}: Game playing argument}\label{fig:2TGame}
\end{figure}

%\caption{PRF adversary $B$ simulating $\game{1}(A)$ and $\game{2}(A)$
\begin{figure}
\centering
\fpage{0.5}{
$\adversaryv{B^{\calO}}$\\
$S \getsr \distr{\calS}{}$\\
$\err \gets 0$\\
$(\pubaux,\privaux) \getsr \Rep^{\HashOracle}(S)$\\
Run~$A(S, \pubaux)$\\
When $A$ asks $\TestOracle(q_x)$:\\
\nudge $a \gets \Qry^{\HashOracle}(\pubaux,\privaux,q_x)$\\
\nudge if $a \neq q_x(S)$ then \\
\nudge \nudge $\err \gets \err +1$\\
\nudge Return~$(a,\err )$\\
When $A$ halts: \\
\nudge if $\err  < r$ then Return 0\\
\nudge Return 1\\\\
%
%
\oracle{$\HashOracle(x)$}\\
\nudge Ret $\OK$, for $j\in[1,k]$\\
}
\caption{\Cref{thm2}: PRF adversary $B$ simulating $\game{1}(A)$ and $\game{2}(A)$} \label{fig:2TD}
\end{figure}	


\end{proof}
